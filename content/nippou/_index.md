---
title: 日報
layout: single

---
### 日報

2019/06/12

Extemporeのソースを改めて読んでてやっとわかったけど、あれはCPPで実装されたSchemeで、xtlangのJITコンパイルとか、型部分のシンタックスシュガーとかJITコンパイルのllコード吐くところはみんなScheme自身でランタイムで行われている、恐ろしや。。確かにギリギリmalloc命令だけ確保しておけばあとは作った言語側で実装できるんだろうか・・・。

2019/06/11

引き続きLLVMのcodegenの資料を読み漁っていたが、いざ実装するとなると結構重い。というか、何も考えずにやっているとLLVMのレジスタマシンっぽい、命令型言語の仕様に引っ張られそうになるので開発の仕様考え直すのに時々戻らないといけない。そして、ちょっと関数型っぽい仕様を取り入れたいとか思うと型についてもっときちんと勉強しないとダメだとなってくる（インタプリタ型ならともかく、LLVM IRに落とすまでの体力がない）。gocamlのスライドとか読むと、型付きの命令列というさらに中間表現的なものに一度落とし込むという手もあるっぽい。

で、ここまで考えたけどやっぱり一度Extempore（xtlang）の型推論付きトランスパイラにしちゃった方が賢いのではないだろうか。最悪後からランタイムは作り直せるわけだし、パーサーとASTは使いまわせるはず、だし・・・

2019/06/10

LLVMのJITの資料少し読みあさり、パーサーにAssign機能を追加して、地味なリファクタリングをした。

午後、Exidiophone基板の発注をする（アセンブリサービスがセールだったので試してみた）。Maxを入れてなかったのでインストールする。

Kronosの開発者の人にSlackで色々聞いてみる。自分のやってることについても少し案を話せたのでよかった

帰ってから、関数周りのパーサーを追加した。これで最低限プログラミングっぽいことができると思うので、次はllvmのcodegenを試したい。KareidoScopeぐらいにはなってきたのではないか

2019/06/09

朝ランして、LLVMをインポート→IRBuilderを使ってビルドを通すところまでやった（まだ.llファイル吐き出せてない）。演算子ごとにswitchでcodegenする関数を切り替えたくてBison側のenumを引っ張ってこようと思って適当にやっていたら循環includeになりまくって死んだ。時間無駄にする前にノートとかで整理した方がいいという学びがあった

2019/06/08

土曜なので少し控えめに、、、インタプリタ部の実装（スケジューラーとか）をどうしようかなーと思ってExtemporeの実装を眺めたり、LLVMの仕様を見たり、OSのsleep関数の仕様を調べて、あとは家事をしてたらだいたい1日が終わった感　明日はコードを何かしら書こう

2019/06/07

パーサーに時間操作の演算子だけ実装した。未踏のやつか公開になって、思ったより反応があって驚いた。いっつも作ったものに対して「ハ？」みたいな反応される方が普通なので、まだ何も作ってない段階から期待されることにめちゃくちゃ重圧を感じる・・・しかし音楽系の人からもそれなりに反応があったのがわかってよかった。

2019/06/06

ようやくBisonでビルドが通るところまで行ったので基本的なASTが組み立てられるところまで実装、変数登録できるとこまで行ったら時間操作の奴取り組み始める、の順番でいいのかな

2019/06/05

今日もBisonでのパーサーの書き直し、ビルドが全然通る気配がないし、インクリメンタルな開発が全然できないので辛い

2019/06/04

Bison,FlexをCじゃなくC++としてジェネレートする方が良さそうなため、そちらのビルドのやり方探しに時間をかけてしまう。

2019/06/03

諸用で東京へ。テクニカルな進捗は特になし

2019/06/02

Exidiophoneのボディ作りの続きをした、コーディングにどうしても気が乗らないんだけど、これはどっちかというと何をいつまでにどのくらいやったらいいのかの目標がはっきりしなくなってきたからだな、中短期的目標を引きなおさなければ。。

2019/06/01

朝ランして、パーサーをflexとbisonで書き直し始めた。結構これまでの努力が徒労になっている気がするが、しょうがない・・・。テスト駆動開発がこれでできるんだかできないんだかよくわからない。

出先でExidiophoneの新しいボディのモデルを軽く作る。いつ出力するかな

帰ってきたら急に疲れたので小休憩して、OSS活動（Homebrew野良repoのメンテ）をした

2019/05/31

合同ゼミがあったので雑なスライドだけ作って挑む。一旦関心ごとをブワッと広げて話したけどおかげでやっぱり伝わんなかったね。やっぱり研究の方法論の問題系だけ絞ってExidiophoneで論文を書くのがいいのかもしれないと思った。

2019/05/30

朝ランした。事務仕事周りを少し片付けたら眠くなってしまったので家に帰って休眠。しばらく色々ゴタゴタしたのでしょうがない。

2019/05/29

ベッドの搬入をして、ついでに買ってしまったSK-88proとかも受け取る。論文が思ったよりサクッと進んだというか、気がついたらまともな感じになっているかもしれない。実装から離れているので戻らなければ

頑張って論文を提出。

2019/05/28

Fairlightの続き→授業をやって、片付けして、三月の水に行き、Copy Cont Rollを見る。論文・・・

2019/05/27

朝ランした

蓮沼さんと一日Fairlightをいじる。

2019/05/26

暑いので学校で作業をしようと思う→時間外入館手続きしてなく入れない→展示へ行く→SSD持ってきてなかったことに気がつくのコンボを食らう

帰ってからどうにか論文を少し進める、が早くも夏バテ

変数に時間付随させるのと関数でhistory扱うのうまく切り分けないとごっちゃになるな

2019/05/25

だいぶ疲れていたので、昼まで休んで買い物をして帰る。全然何もできなかった・・・。

2019/05/24

朝ランした、パーサーにトップレベル加える、その他もろもろ手直し。

学校いって論文イントロ書いた。なんか図を作った方がいいな。。

論文進まず、パーサーに配列を加える。あとインタプリタのクラスを作り始める・・・。

2019/05/23

論文書き。あんまり構想まとまらないのでパーサの微妙な直しに逃げたりしたが、よくなかった気がする

パーサのAST、多分unique_ptrで持ってる方が良くていちいちmoveで移動させてあげた方が正しいんだろうけど書き方が煩雑になるくらいならshared_ptrのままにした方がいいのか迷う。

あとS式で書く意味あるか？パフォーマンス的にそもそも悪いのはわかってたけど、関数定義の構文糖衣とかlambdaに変換して持たせるのは破壊的変換だから、そっから完全なソースコードの展開はできないのでいっそソースコードを生でエディタと共有させた方がいいよな

2019/05/22

パンを焼いて1日が終わった

2019/05/21

朝ランした。ポスターの原稿を書き始める。言語仕様を少しだけ明確にしたので、ランタイムでやらなきゃいけないことは見えてきた。これは結局ChucKのような同期型になるのかな

2019/05/20

寝起きが悪かった。図書館に本を返さなきゃいけないので学校に行く。少しパーサのクラス直しをした。お昼を食べてパーサをさらに書いた。ここまでくると一旦ランタイムを最低限何があれば動くのか決めて動かせるようにするべきだな

2019/05/19

朝ランした、CppcmbやっぱわかんなすぎてIssueで質問立てた。

Daxophoneのモデルちょっと進めた。どうせ穴とかは５軸じゃないと削れないしこのくらいで一回やってみようかな

質問スッゲー早く帰ってきて無事中置記法→ネストS式のパーサ書けた！これで大分進む気がする

***

2019/05/18

ChucKのリポジトリの中にDesignていうフォルダがあって設計時のメモ書きがそのまま残ってる感じはいいなと思ったので参考にしよう

C++用のGoogleTestフレームワークを導入したので少しコンパイラ開発が建設的にはなった。しかし結局パーサコンビネータの再帰がうまく行ってなくてダメな予感。いや、やっぱりそもそもモナディックパーサ使っててASTの構造を普通のクラスでやってるからダメなんだ、全部関数で返せば良いのか

今更だけど、中置記法の演算をASTではS式っぽい形で持ってるとしたら中置記法をその言語の中で自分で定義することはできなくなるってことか（まあそんなことC++でさえできない訳だけど）

基本的なところはcppcmbが全部やってくれるんだから、パースした結果を受け取る側で加工してまとめてS式なりのASTにすればよい？

実装はともかくとして、少しずつ具体的な言語仕様とか文法が見えてきた

2019/05/17

新しいクレカを契約したら暗証番号が5ケタでどうしても覚えられず、1回目でいきなり間違えたらそこら中にアラートが行って締め出されるというすごい嫌な夢で起きた。夢日記を書くのはよくないとは言えロクでもなさがすごい

朝から大濠公園まで自転車でいき、学振最後の直しをする。天神で色々してから帰って、自転車の掃除をし、洗濯、料理をした。

Exidiophoneの回路の改良を少しして、後Daxophoneの記事読んでこれやっぱり今年中に作りたいなと思い、Fusionで図面を引いてみるのだった。結果図面の数値がよくわからなくて手作業でやることにしたが

2019/05/16

朝からまあまあ調子が悪いけど学振申請書の直しをした。國本さんのEPが出たので聴きながら。音源を今年は頑張って作りたいなーと思っている。今年やりたいことがいっぱいなので全部実現したい。

午後は一枚Exidiophoneの基板を半田付けして、前から作ろうと思っていたボタン電池式の2x2アクティブマトリクスミキサーの回路をEagleで作ってみる。コンパイラ作りはお休み。

2019/05/15

朝ランして、学校に行ってイヤホンを修理した。
言語仕様決めるのをずっとやり続けるけど、よくわからなくなってきた

時相論理というものの存在を知った、Temporal Calculus of Communicating Systems とか、便利そうだけど難しすぎて全然わからん

***

2019/05/14

ちょっとChucKのソースをビルドしてみて流れを追いかけたりした。結構コンパイラとVMの結合がきついんですけど。。。全然追えない

***

2019/05/13

朝ランしてたら転んで絆創膏を４枚貼る羽目になった
CPPcmbと格闘して1日終了
型付きでやるとastのデータ構造作るのがJSとかと比べて難しいったらありゃしない！
かといってany型とかは使いたくないし、どうすんのがいいんだろうな
こんなとこで止まっててもしょうがないんだけどー、、

***

2019/5/12

予定を整理したりした、

CppCmbを使い始めた、というかそれのためのCmakeの使いかたのお勉強かも
あとUltralight.uxのサンプルもちょっと動かした 結局インタラクションやろうとするとJS書かないと意味ない？

いい加減言語仕様を仮に作ってみないとASTも作れないので考えよう ていうかパーサ書きながら考えよ