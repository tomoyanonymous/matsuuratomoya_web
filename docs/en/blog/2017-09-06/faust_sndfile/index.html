<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/tomorrow.min.css">
    <link rel="shortcut icon" href="/assets/img/favicon.ico">
    <link rel="canonical" href="http://matsuuratomoya.com">
    
  
    <meta name="viewport" content="width=625">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="keyword" content="松浦知也,Matsuura Tomoya,">
  <meta name="description" content="This article is introduction how to apply effects written in faust to wave files.

">
  <meta http-equiv="content-language" content="en" />
  <meta property="og:title" content="process wav file simply with faust2sndfile | Matsuura Tomoya|松浦知也" />
  <meta property="og:type" content="article">
  <meta property="twitter:card" content="summary" />
  <meta property="twitter:site" content="@tomoya_nonymous">
    <meta property="twitter:creator" content="@tomoya_nonymous">
    <meta property="twitter:creator:id" content="@tomoya_nonymous">
<meta property="og:url" content="https://matsuuratomoya.com/en/blog/2017-09-06/faust_sndfile/" />
<meta property="og:image" content="https://matsuuratomoya.com/assets/img/image_ogp.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="fb:app_id" content="1756749324544053" />
  <meta property="og:description" content="
  This article is introduction how to apply effects written in faust to wave files.

"/>
    <title>process wav file simply with faust2sndfile | Matsuura Tomoya|松浦知也 </title>
  </head>

<body>
  
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-KSWGLR"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KSWGLR');</script>


  <div class="outer">

    
<header>
  <div>
      <a href="https://matsuuratomoya.com/"><div class="title">Matsuura Tomoya</div></a>

      <div class="menu">
        
        
        <a href="https://matsuuratomoya.com/about"><div >about</div></a>
        
        <a href="https://matsuuratomoya.com/info"><div >info</div></a>
        
        <a href="https://matsuuratomoya.com/works"><div >works</div></a>
        
        <a href="https://matsuuratomoya.com/blog"><div >blog</div></a>
        
        <a href="https://matsuuratomoya.com/contact"><div >contact</div></a>
        
      </div>
    <div class="locales">
      
      <a href="/blog/2017-09-06/faust_sndfile/">
        <span>
          ja

        </span>
      </a>
      
    </div>

    <div class="social">
      <div class="tw">
  <div class="logo">
    <a href="https://twitter.com/tomoya_nonymous" target=”_blank”>
      <img src="/assets/img/tw.png" alt="twitter">
    </a>
  </div>
  </div>
  <div class="fb">
    <div class="logo">
      <a href="https://www.facebook.com/tomoya.matsuura.98" target=”_blank”>
        <img src="/assets/img/fb.png" alt="facebook">
      </a>
    </div>
  </div>

  <div class="github">
    <div class="logo">
      <a href="https://github.com/tomoyanonymous" target=”_blank”>
        <img src="/assets/img/github.png" alt="github">
      </a>
    </div>
  </div>

  <div class="instagram">
    <div class="logo">
      <a href="https://www.instagram.com/tomoya_nonymous" target=”_blank”>
        <img src="/assets/img/instagram.png" alt="instagram">
      </a>
    </div>
  </div>
  <div class="vimeo">
    <div class="logo">
      <a href="https://vimeo.com/tomoyamatsuura" target=”_blank”>
        <img src="/assets/img/vimeo.png" alt="Vimeo">
      </a>
    </div>
  </div>
    <div class="soundcloud">
      <div class="logo">
        <a href="https://soundcloud.com/tomoya_matsuura" target=”_blank”>
          <img src="/assets/img/soundcloud.png" alt="Soundcloud">
        </a>
      </div>
  </div>

    </div>
    </div>
</header>

    <div class="inner">
      <div class="child">

        <div class="content">
          <p class="date">2017-09-06(Wed)</p>
          
          <p class="title"><a href="https://matsuuratomoya.com/en/blog/2017-09-06/faust_sndfile/">process wav file simply with faust2sndfile</a></p>
          <div class="markdown">
            <p>This article is introduction how to apply effects written in faust to wave files.</p>

<p></p>

<h1 id="the-pros-with-faust">The Pros with faust</h1>

<p>It&rsquo;s highly faster and simpler than the case of Matlab or Python.
Surely faust can&rsquo;t apply complex process such as statistical or relates to multiple files. However, sometimes we have to accomplish boring tasks, for instance, apply the same filter to a lot of wav files as preparation of the main task.</p>

<p>Also, we can use, ffmpeg filter or Audacity/DAW&rsquo;s Automation but sometimes their processes are the black box.</p>

<h2 id="cons">Cons</h2>

<p>Currently, the length of samples generated are the same as input file. This means the effector which has a long tale, such as the delay with a feedback or reverb would be cut before it ends.</p>

<hr />

<h1 id="faust2sndfile">faust2sndfile</h1>

<p>In this time, We use this tool faust2sndfile. Unfortunately We can&rsquo;t use this with FaustLive or Online Compiler yet. So We have to install faust locally.</p>

<h2 id="install-faust-locally">Install Faust locally</h2>

<p>Follow the instruction in the <a href="https://github.com/grame-cncm/faust">readme</a> of faust.
If you are Homebrew user,<a href="https://github.com/tomoyanonymous/homebrew-faust">I made the formula</a>. Please try this.</p>

<p>The latest stable release, v2.1.0, dosen&rsquo;t include faust2sndfile, you need to install the HEAD of the faust2 branch. if you use homebrew, append <code>--HEAD</code> option.</p>

<p>If you install faust, faust2sndfile will be installed at the same time.</p>

<h2 id="inside-the-script">Inside the script</h2>

<p><a href="https://github.com/grame-cncm/faust/blob/master-dev/tools/faust2appls/faust2sndfile">https://github.com/grame-cncm/faust/blob/master-dev/tools/faust2appls/faust2sndfile</a></p>

<p>faust2sndfile is, actually, a simple shell script.</p>

<p>It compiles .dsp file into a binary with sndfile architecture.</p>

<p>And, We can execute the generated binary with arguments &lt;inputfile-path&gt; &lt;outputfile-path&gt;.</p>

<p>You need to install LibSndFile to build a binary. You can test if it is installed.</p>

<pre><code class="language-bash">pkg-config --cflags --static --libs sndfile
</code></pre>

<p>If no error, you can use libsndfile. If you got an error, you can install via homebrew like this.</p>

<pre><code>brew install libsndfile
</code></pre>

<h1 id="use">Use</h1>

<pre><code class="language-bash">faust2sndfile -h
</code></pre>

<p>If you get <code>faust2sndfile &lt;file.dsp&gt;</code>, faust2sndfile is installed correctly.</p>

<p>So Let&rsquo;s make simple .dsp file something like below.</p>

<pre><code class="language-java">import(&quot;stdfaust.lib&quot;);
process = fi.lowpass(1,1000),fi.lowpass(1,1000);
</code></pre>

<p>It&rsquo;s simple lowpass fillter which pass through under 1000Hz sound.
and save with the name <code>lowpass.dsp</code>.</p>

<pre><code class="language-bash">faust2sndfile lowpass.dsp -double
</code></pre>

<p>Compile and build the binary with the command. For tips, option flags to faust compiler must be given at this time. Though we may use only it of specifying precision like <code>-double</code> or <code>quad</code> at this time.</p>

<p>Then, we will get a binary with the name of <code>lowpass</code>.
So we have to do only execute it below.</p>

<pre><code class="language-bash">./lowpass test.wav test_processed.wav
</code></pre>

<p>The first argument is the input file, the second is the output.</p>

<p><img src="/assets/img/faust/faust_simplelowpass.png" alt="" /></p>

<p>The avobe is the spectrogram before process and below is the after. We can see the applied sound doesn&rsquo;t have the sound in over 1000Hz.</p>

<p>The output format follows the input&rsquo;s extension.
It using libsndfile so we can use wav, aiff and even flac.</p>

<p>If faust code is monaural process and Input file is Stereo, Only Lch will be processed and generated with no error or warnings.</p>

<h1 id="process-multiple-files">Process multiple files</h1>

<p>I tried to write this script, but I don&rsquo;t ensure if it works correctly. So use your own responsibility.</p>

<pre><code class="language-bash">#!/bin/bash

dsp='./lowpass'

src=($(find src -name '*.wav' -o -name '*.aif'))

mkdir out

faust2sndfile $(echo $dsp'.dsp') -double

for obj in &quot;${array[@]}&quot;; do
  echo $obj
  out=$(echo $obj | sed s/src/out/g)
  dsp $obj $out
done

</code></pre>

            <div class="share">
  <div class="tweet">
<a href="https://twitter.com/share" class="twitter-share-button" data-size="large" data-url="https://matsuuratomoya.com/en/blog/2017-09-06/faust_sndfile/" data-related="tomoya_nonymous">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>

<div class="fb-share-button" data-href="https://matsuuratomoya.com/en/blog/2017-09-06/faust_sndfile/" data-layout="box_count" data-mobile-iframe="true"></div>

</div>

            <hr>

<div class="fb-comments" data-width="100%" data-href="https://matsuuratomoya.com/en/blog/2017-09-06/faust_sndfile/" data-numposts="5"></div>

            <div class="pagination">

<ul>
  <li class="to_next">

    <a href=""  class="none">
        
    &lt;&lt;

    </a>

  </li>
  <li class="to_index">

    <a href="../">^</a>

  </li>
  <li class="to_prev">

    <a href="" class="none">

    >>
    
    </a>
  </li>


</ul>
</div>

          </div>
        </div>

      </div>

    </div>
    
  <footer>
<div class="child">

<p class = "copyrights">

<a href="https://matsuuratomoya.com/license">2016-2017 (CC BY-NC-ND 4.0) Matsuura Tomoya</a>
</p>
</div>
</footer>

  </div>
</body>
</html>
