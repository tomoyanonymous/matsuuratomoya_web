 <!DOCTYPE html>
<html lang="ja" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/tomorrow.min.css">
    <link rel="shortcut icon" href="/assets/img/favicon.ico">
    <link rel="canonical" href="http://matsuuratomoya.com">
    <link rel="next" href="Page%28%22Cycling74-Max%e3%81%aePattr%e3%82%92%e3%81%a1%e3%82%83%e3%82%93%e3%81%a8%e4%bd%bf%e3%81%84%e5%80%92%e3%81%99%22%29">
  <link rel="prev" href="Page%28%22Puredata%e3%81%a7%e8%a9%95%e4%be%a1%e5%ae%9f%e9%a8%93%28%e3%82%b5%e3%83%b3%e3%83%97%e3%83%ab%e3%83%91%e3%83%83%e3%83%81%e3%81%82%e3%82%8a%29%22%29">
    <meta name="viewport" content="width=625">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="keyword" content="松浦知也,Matsuura Tomoya,">
  <meta name="description" content="このページ自体をGithub Pagesでホストしているのですが、


ソース自体もgithubで管理したい
しかしリポジトリのルートからホスティングされるためbuildとかに入れてると例えば前者なら.github.io/buildにアクセスしないといけない
そうすると相対パスが狂ったりする
公式でおすすめされてるJekyllはインソースビルドしてるがフォルダ構造が汚くなるのでやりたくない


などの問題があります。これをどうにか解決しようと頑張った。
">
  <meta http-equiv="content-language" content="ja" />
  <meta property="og:title" content="Github pagesで意地でもサブディレクトリをルートにする | Matsuura Tomoya|松浦知也" />
  <meta property="og:type" content="article">
  <meta property="twitter:card" content="summary" />
  <meta property="twitter:site" content="@tomoya_nonymous">
    <meta property="twitter:creator" content="@tomoya_nonymous">
    <meta property="twitter:creator:id" content="@tomoya_nonymous">
<meta property="og:url" content="http://matsuuratomoya.com/blog/2016-05-07/githubpage-subdirectory/" />
<meta property="og:image" content="http://matsuuratomoya.com/assets/img/image_ogp.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="fb:app_id" content="1756749324544053" />
  <meta property="og:description" content="
  このページ自体をGithub Pagesでホストしているのですが、


ソース自体もgithubで管理したい
しかしリポジトリのルートからホスティングされるためbuildとかに入れてると例えば前者なら.github.io/buildにアクセスしないといけない
そうすると相対パスが狂ったりする
公式でおすすめされてるJekyllはインソースビルドしてるがフォルダ構造が汚くなるのでやりたくない


などの問題があります。これをどうにか解決しようと頑張った。
 |  "/>
    <title>Github pagesで意地でもサブディレクトリをルートにする | Matsuura Tomoya|松浦知也 </title>
  </head>

<body>
  
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-KSWGLR"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KSWGLR');</script>


  <div class="outer">

    
<header>
  <div>
      <a href="http://matsuuratomoya.com/"><div class="title">Matsuura Tomoya</div></a>

      <div class="menu">
        
        
        <a href="http://matsuuratomoya.com/about"><div >about</div></a>
        
        <a href="http://matsuuratomoya.com/info"><div >info</div></a>
        
        <a href="http://matsuuratomoya.com/works"><div >works</div></a>
        
        <a href="http://matsuuratomoya.com/blog"><div >blog</div></a>
        
        <a href="http://matsuuratomoya.com/contact"><div >contact</div></a>
        
      </div>
    <div class="locales">
      
    </div>

    <div class="social">
      <div class="tw">
  <div class="logo">
    <a href="https://twitter.com/tomoya_nonymous" target=”_blank”>
      <img src="/assets/img/tw.png" alt="twitter">
    </a>
  </div>
  </div>
  <div class="fb">
    <div class="logo">
      <a href="https://www.facebook.com/tomoya.matsuura.98" target=”_blank”>
        <img src="/assets/img/fb.png" alt="facebook">
      </a>
    </div>
  </div>

  <div class="github">
    <div class="logo">
      <a href="https://github.com/tomoyanonymous" target=”_blank”>
        <img src="/assets/img/github.png" alt="github">
      </a>
    </div>
  </div>

  <div class="instagram">
    <div class="logo">
      <a href="https://www.instagram.com/tomoya_nonymous" target=”_blank”>
        <img src="/assets/img/instagram.png" alt="instagram">
      </a>
    </div>
  </div>
  <div class="vimeo">
    <div class="logo">
      <a href="https://vimeo.com/tomoyamatsuura" target=”_blank”>
        <img src="/assets/img/vimeo.png" alt="Vimeo">
      </a>
    </div>
  </div>
    <div class="soundcloud">
      <div class="logo">
        <a href="https://soundcloud.com/tomoya_matsuura" target=”_blank”>
          <img src="/assets/img/soundcloud.png" alt="Soundcloud">
        </a>
      </div>
  </div>

    </div>
    </div>
</header>

    <div class="inner">
      <div class="child">

        <div class="content">
          <p class="date">2016-05-07(Sat)</p>
          
          <p class="title"><a href="http://matsuuratomoya.com/blog/2016-05-07/githubpage-subdirectory/">Github pagesで意地でもサブディレクトリをルートにする</a></p>
          <div class="markdown">
            <p>このページ自体をGithub Pagesでホストしているのですが、</p>

<ul>
<li>ソース自体もgithubで管理したい</li>
<li>しかしリポジトリのルートからホスティングされるためbuildとかに入れてると例えば前者なら<Githubのユーザー名>.github.io/buildにアクセスしないといけない</li>
<li>そうすると相対パスが狂ったりする</li>
<li>公式でおすすめされてるJekyllはインソースビルドしてるがフォルダ構造が汚くなるのでやりたくない</li>
</ul>

<p>などの問題があります。これをどうにか解決しようと頑張った。
</p>

<h1 id="試行錯誤">試行錯誤</h1>

<p>git subtreeを使ってサブディレクトリだけ別ブランチにプッシュすればいけるのでは？と思いやってみる。</p>

<p>そういえばGithub Pagesのホスティングは2種類あって、gh-pagesというブランチを作れば勝手にホスティングされるんだったなと思い、</p>

<pre><code class="language-bash">$ git subtree push -P build origin gh-pages
</code></pre>

<p>これでいけんじゃね？と思い、push出来てホスティングも出来たがドメインの設定になってミスに気づく。</p>

<p>Github Pagesにはホスティングの仕方が2種類あって、</p>

<ul>
<li>User Page:リポジトリ名を<Githubのユーザー名>.github.ioにするとそのURLにmasterブランチをルートにしてホスティングされる</li>
<li>Project Page: gh-pagesブランチを作ると<Githubのユーザー名>.github.io/&lt;リポジトリ名&gt;でホスティングされる</li>
</ul>

<p>ここで例えばmatsuuratomoya.comからリダイレクトするようにしても、matsuuratomoya.com/リポジトリ名でしかリダイレクトしてくれません。</p>

<p><a href="https://help.github.com/articles/custom-domain-redirects-for-github-pages-sites/">https://help.github.com/articles/custom-domain-redirects-for-github-pages-sites/</a></p>

<p>ということはなんとか前者にしなければいけません。</p>

<h1 id="解決法">解決法</h1>

<p>結論から言うと*ソースを入れてるフォルダをmaster以外のブランチに移し*、*buildフォルダをsubtreeとしてmasterブランチに作る*ので解決なんですが、すでにリモートのmasterブランチにファイルがいたりするとコンフリクトして大変なのでメモ書きすると</p>

<pre><code class="language-bash">$ git branch -m working #masterからworkingという適当な名前の新しいブランチに移動
$ git push #リモートにもworkingを作る
$ git branch -D master #一旦masterブランチを消去
</code></pre>

<p>ここで、一旦Githubのページ上で作業する。</p>

<ul>
<li>デフォルトブランチをworkingに変更(こうしないとmasterブランチを消せない)</li>
<li>masterブランチを削除</li>
<li>あと、リポジトリ名は＜ユーザー名＞.github.ioにしておく</li>
</ul>

<p>再びローカルで</p>

<pre><code class="language-zsh">$ git subtree push -P ./build origin master #リモートのmasterにbuild以下をpushする
</code></pre>

<p>でめでたくユーザー名.github.ioにホスティングされ、独自ドメインを設定してもうまくいきます。</p>

<p>後はずっとworkingブランチで作業してソースを変更したら普通にコミット&amp;プッシュ（もちろんリモートもworkingブランチに）
デプロイするときは$ git subtree push -P ./build origin masterすればOK。</p>

<p>一つのリポジトリに全く内容の違うブランチが混在してるのも気持ち悪いですが、これを避けるためにはローカルで別フォルダにリモートリポジトリを作って同じことをすればいいですが・・・めんどくさいです・・・。</p>

<p>そもそも現状ソースフォルダとビルドフォルダに内容同じ画像フォルダを持っている時点でインソースビルドのほうが賢い気もします。
もうちょっといい方法があったら教えてほしい。</p>

            <div class="share">
  <div class="tweet">
<a href="https://twitter.com/share" class="twitter-share-button" data-size="large" data-url="http://matsuuratomoya.com/blog/2016-05-07/githubpage-subdirectory/" data-related="tomoya_nonymous">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>

<div class="fb-share-button" data-href="http://matsuuratomoya.com/blog/2016-05-07/githubpage-subdirectory/" data-layout="box_count" data-mobile-iframe="true"></div>

</div>

            <hr>

<div class="fb-comments" data-width="100%" data-href="http://matsuuratomoya.com/blog/2016-05-07/githubpage-subdirectory/" data-numposts="5"></div>

            <div class="pagination">

<ul>
  <li class="to_next">

    <a href="
    http://matsuuratomoya.com/blog/2016-05-08/maxmsp_pattr/
    "  >
        
      Cycling74-MaxのPattrをちゃんと使い倒す
  
    &lt;&lt;

    </a>

  </li>
  <li class="to_index">

    <a href="../">^</a>

  </li>
  <li class="to_prev">

    <a href="
     http://matsuuratomoya.com/blog/2016-04-27/puredata_subjective/
    " >

    >>
    
    Puredataで評価実験(サンプルパッチあり)
    
    </a>
  </li>


</ul>
</div>

          </div>
        </div>

      </div>

    </div>
    
  <footer>
<div class="child">

<p class = "copyrights">

<a href="http://matsuuratomoya.com/license">2016-2018 (CC BY-NC-ND 4.0) Matsuura Tomoya</a>
</p>
</div>
</footer>

  </div>
</body>
</html>
