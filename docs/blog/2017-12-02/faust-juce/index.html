<!DOCTYPE html>
<html lang="ja" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/tomorrow.min.css">
    <link rel="shortcut icon" href="/assets/img/favicon.ico">
    <link rel="canonical" href="http://matsuuratomoya.com">
    
  <link rel="prev" href="Page%28%22%e7%be%8e%e5%a4%a7%e3%83%bb%e9%9f%b3%e5%a4%a7%e7%b3%bb%e5%ad%a6%e7%94%9f%e3%82%a4%e3%83%99%e3%83%b3%e3%83%88%e3%81%aeWeb%e3%82%b5%e3%82%a4%e3%83%88%e3%81%a9%e3%81%86%e3%81%ab%e3%81%8b%e3%81%aa%e3%82%93%e3%81%aa%e3%81%84%e3%81%ae%e3%81%8b%e5%95%8f%e9%a1%8c%22%29">
    <meta name="viewport" content="width=600">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="keyword" content="松浦知也,Matsuura Tomoya,">
  <meta name="description" content="この記事はFaust Advent Calender 2017の2日目の記事とJUCE Advent Calenderの合同記事です（手抜きと呼ばないで）。

https://qiita.com/advent-calendar/2017/faust

https://qiita.com/advent-calendar/2017/juce

2017年、FaustもJUCEも色々アップデートが進みまして連携も取りやすくなったので、Faust&amp;JUCEで簡単にGUIつきVSTを作るチュートリアル記事を書いていきます。

">
  <meta http-equiv="content-language" content="ja" />
  <meta property="og:title" content="Faust&amp;JUCEによる超高速VST開発 | Matsuura Tomoya|松浦知也" />
  <meta property="og:type" content="article">
  <meta property="twitter:card" content="summary" />
  <meta property="twitter:site" content="@tomoya_nonymous">
    <meta property="twitter:creator" content="@tomoya_nonymous">
    <meta property="twitter:creator:id" content="@tomoya_nonymous">
<meta property="og:url" content="https://matsuuratomoya.com/blog/2017-12-02/faust-juce/" />
<meta property="og:image" content="https://matsuuratomoya.com/assets/img/faust/faust_editor_ogp.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="fb:app_id" content="1756749324544053" />
  <meta property="og:description" content="
  この記事はFaust Advent Calender 2017の2日目の記事とJUCE Advent Calenderの合同記事です（手抜きと呼ばないで）。

https://qiita.com/advent-calendar/2017/faust

https://qiita.com/advent-calendar/2017/juce

2017年、FaustもJUCEも色々アップデートが進みまして連携も取りやすくなったので、Faust&amp;JUCEで簡単にGUIつきVSTを作るチュートリアル記事を書いていきます。

"/>
    <title>Faust&amp;JUCEによる超高速VST開発 | Matsuura Tomoya|松浦知也 </title>
  </head>

<body>
  
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-KSWGLR"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KSWGLR');</script>


  <div class="outer">

    
<header>
  <div>
      <a href="https://matsuuratomoya.com/"><div class="title">Matsuura Tomoya</div></a>

      <div class="menu">
        
        
        <a href="https://matsuuratomoya.com/about"><div >about</div></a>
        
        <a href="https://matsuuratomoya.com/info"><div >info</div></a>
        
        <a href="https://matsuuratomoya.com/works"><div >works</div></a>
        
        <a href="https://matsuuratomoya.com/blog"><div >blog</div></a>
        
        <a href="https://matsuuratomoya.com/contact"><div >contact</div></a>
        
      </div>
    <div class="locales">
      
    </div>

    <div class="social">
      <div class="tw">
  <div class="logo">
    <a href="https://twitter.com/tomoya_nonymous" target=”_blank”>
      <img src="/assets/img/tw.png" alt="twitter">
    </a>
  </div>
  </div>
  <div class="fb">
    <div class="logo">
      <a href="https://www.facebook.com/tomoya.matsuura.98" target=”_blank”>
        <img src="/assets/img/fb.png" alt="facebook">
      </a>
    </div>
  </div>

  <div class="github">
    <div class="logo">
      <a href="https://github.com/tomoyanonymous" target=”_blank”>
        <img src="/assets/img/github.png" alt="github">
      </a>
    </div>
  </div>

  <div class="instagram">
    <div class="logo">
      <a href="https://www.instagram.com/tomoya_nonymous" target=”_blank”>
        <img src="/assets/img/instagram.png" alt="instagram">
      </a>
    </div>
  </div>
  <div class="vimeo">
    <div class="logo">
      <a href="https://vimeo.com/tomoyamatsuura" target=”_blank”>
        <img src="/assets/img/vimeo.png" alt="Vimeo">
      </a>
    </div>
  </div>
    <div class="soundcloud">
      <div class="logo">
        <a href="https://vimeo.com/tomoya_matsuura" target=”_blank”>
          <img src="/assets/img/soundcloud.png" alt="Soundcloud">
        </a>
      </div>
  </div>

    </div>
    </div>
</header>

    <div class="inner">
      <div class="child">

        <div class="content">
          <p class="date">2017-12-02(Sat)</p>
          
          <p class="title"><a href="https://matsuuratomoya.com/blog/2017-12-02/faust-juce/">Faust&amp;JUCEによる超高速VST開発</a></p>
          <div class="markdown">
            <p><em>この記事はFaust Advent Calender 2017の2日目の記事とJUCE Advent Calenderの合同記事です（手抜きと呼ばないで）。</em></p>

<p><a href="https://qiita.com/advent-calendar/2017/faust">https://qiita.com/advent-calendar/2017/faust</a></p>

<p><a href="https://qiita.com/advent-calendar/2017/juce">https://qiita.com/advent-calendar/2017/juce</a></p>

<p>2017年、FaustもJUCEも色々アップデートが進みまして連携も取りやすくなったので、Faust&amp;JUCEで簡単にGUIつきVSTを作るチュートリアル記事を書いていきます。</p>

<p></p>

<h1 id="まず">まず</h1>

<h2 id="faustとは">Faustとは</h2>

<p>FaustはフランスのGrameという研究所が中心に開発している、簡潔（かつやや特殊）な記法で信号処理を記述することができるプログラミング言語で、C++を経由してスタンドアロンアプリ、VST/AU/LADSPA/Lv2プラグイン、JUCEなどの様々なアーキテクチャ、さらにはOWLやBelaなどのハードウェアプラットフォームにもと、様々なプラットフォームへエクスポートが出来る環境を備えています。
また最近ではLLVMを利用して実行時コンパイルやWebAudioなどへのエクスポートも可能です。</p>

<p>詳しくは<a href="https://tomoyanonymous.github.io/faust_jp_tutorial/index.html#/">こちらのスライド</a>や、<a href="https://matsuuratomoya.com/blog/2016-12-01/faust_introduction">この紹介記事</a>を参照下さい。</p>

<p>今年は初めて日本での勉強会が開かれたりするなど少しずつユーザーが増えてきています。</p>

<h2 id="juceとは">JUCEとは？</h2>

<p>JUCEとはGUIつきのオーディオアプリケーションやプラグインを作るためのフレームワーク（オープンソースだが商用ライセンスは有料）で、アドベントカレンダー1日目のCO_COさんが詳しく書いてくださってます。</p>

<p><a href="https://qiita.com/COx2/items/12a48c4a30c49732dcc5">https://qiita.com/COx2/items/12a48c4a30c49732dcc5</a></p>

<blockquote>
<h2 id="juceの特徴は">JUCEの特徴は？</h2>

<p>JUCEの最大の特徴として、オーディオプラグインを開発するためのテンプレートが充実していることが挙げられます。VST/AudioUnit/AAX/RTASプラグインといった、DTMユーザーにはお馴染みのプラグインフォーマットを開発するのに長けており、日本国内外で多くの採用事例があります。</p>
</blockquote>

<h1 id="faust-juce-とりあえず作ってみる">Faust×JUCE、とりあえず作ってみる</h1>

<p>Faustは文法の説明などを始めるとキリがないので、とりあえず1行もコードを書かずにVSTを作るところまでの流れを体感してみようと思います。</p>

<h2 id="ブラウザ上でコードを書く">ブラウザ上でコードを書く</h2>

<p><strong>まずはこちらのURLにアクセスしてみましょう。</strong></p>

<p><a href="http://faust.grame.fr/editor/">http://faust.grame.fr/editor/</a></p>

<p>これはFaustのコードをリアルタイムにブラウザ上で実行、編集できるオンラインエディタです。最近出来たばっかりなのでまだ不安定な部分もありますが・・・。</p>

<p>オンラインエディタを始め、FaustliveなどのだいたいのFaustの開発環境は信号処理の為のFaustコードの集まりである<strong>標準ライブラリ</strong>が読み込めるようになっています。そしてこの中に<strong>デモ</strong>コードが含まれています。</p>

<p><a href="https://faust.grame.fr/libraries.html#demos.lib">https://faust.grame.fr/libraries.html#demos.lib</a></p>

<p>試しに、今回はよくあるイコライザーのデモ<code>parametric_eq_demo</code>というのを使ってみましょう。エディタに次のコードをコピペして下さい。</p>

<pre><code class="language-java">import(&quot;stdfaust.lib&quot;);
process = dm.parametric_eq_demo,dm.parametric_eq_demo;
</code></pre>

<p>コードはたったこの2行です。ざっくり解説すると、</p>

<ul>
<li>importでライブラリファイルを呼び出すことが出来ます。</li>
<li>stdfaust.libは全部のライブラリを呼び出すための親ライブラリで、demo.libの中の変数/関数をdm.hogehogeというかたちで呼び出せます。</li>
<li>なのでdm.parametric_eq_demoで呼び出せるのですが、これだけだとモノラルになってしまうので二つ並列してあげるとステレオになります。</li>
</ul>

<p>このあたりは詳しくは<a href="https://matsuuratomoya.com/blog/2017-01-17/faust_grammer">文法解説</a>をお読み下さい。とりあえず左上のRUNボタンを押すとこのような画面になると思います。</p>

<p><img src="/assets/img/faust/faust_editor.png" alt="オンラインエディタでのGUI画面" /></p>

<p>もしかするとWebAudioの問題でマイクのインプットが拾えずエラーのアラートが出るかもしれませんがとりあえずは問題ありません。マイクが認識されてる場合はマイク入力がスピーカーから出ているはずです（ハウリングにお気をつけ下さい）。</p>

<p>ちなみに左の、下から2番めの写真のアイコン、view block diagramを押すと新しいタブでSVG画像の信号処理ダイアグラムの画面が見られます。</p>

<p><img src="/assets/img/faust/peaqeq.svg" alt="" /></p>

<h2 id="juceプロジェクトをダウンロードする">JUCEプロジェクトをダウンロードする</h2>

<p>さてではここからJUCEとの連携です。</p>

<p>メニュー下から3番目、トラックのアイコンのエクスポートボタンを押してみましょう。</p>

<p><img src="/assets/img/faust/juce_dl.png" alt="" /></p>

<p><strong>プラットフォーム</strong>とその詳細が選べます。ここで各OS→VSTを選ぶといきなりVSTプラグインが落とせるのですが、残念ながら<strong>このプラグインはGUIが出せません</strong>。ここでは画像のようにJUCE→pluginというように選んで下さい。midi入力などが必要なシンセサイザー系はjsynthを選ぶと多分うまくいくはずです。</p>

<p>exportを押すとしばらくするとQRコードが出てきます。これがDLリンクなのでクリックするとZIPが落ちてきます。</p>

<p><img src="/assets/img/faust/juce_dl2.png" alt="" /></p>

<p>ZIPを開くと、</p>

<p><img src="/assets/img/faust/juce_dl3.png" alt="" /></p>

<p>落ちてきているのはJUCEのプロジェクトファイルとcppソースファイルです。</p>

<h2 id="juce側での操作">JUCE側での操作</h2>

<p>というわけでここからはJUCE側での作業です。JUCEの開発環境Projucer、およびVST SDKが入ってない人はインストールして下さい。</p>

<p><a href="https://juce.com/projucer">https://juce.com/projucer</a></p>

<p><a href="https://www.steinberg.net/en/company/developers.html">https://www.steinberg.net/en/company/developers.html</a> (VST SDKは私はユーザフォルダ直下に置いてます。)</p>

<p>このプロジェクトフォルダーを(User)/JUCE/Projectsに移動しましょう（モジュールのパスが相対なので）。</p>

<p>では.jucerファイルを開きます。今回見るべきなのは</p>

<ol>
<li>プロジェクトセッティングのproject type</li>
<li>juceモジュールとVSTSDKのパスが通っているか</li>
</ol>

<p>のみです。</p>

<p>まずプロジェクトセッティングは左上の歯車ボタン。</p>

<p><img src="/assets/img/faust/juce_type.png" alt="" /></p>

<p>ここをAudioPluginにしましょう(普通は最初からなってます)。標準でAudioUnitとスタンドアロンにもチェックが入っていますのでそちらも勝手に出来上がります。</p>

<p>パスについてはJuceモジュールは左サイドバー、モジュールタブの右下の歯車ボタン。</p>

<p><img src="/assets/img/faust/juce_path1.png" alt="" /></p>

<p>後者はFile→Global Search Pathsから（前はプロジェクト単位の設定があった気がするんですが変わったみたいですね？）</p>

<p><img src="/assets/img/faust/juce_path2.png" alt="" /></p>

<p>で設定できます。足りない時は赤くなっているはずです（RTASとかAAX、または自分のOS以外のパスに関しては気にしなくて平気です）。</p>

<p>問題なければSave and Open in IDEで開きましょう。</p>

<h2 id="ide上での操作">IDE上での操作</h2>

<p>今回はMacでやっているのでXcodeでの説明になります。</p>

<p><strong>しかし、基本的にここではもうRunするだけでいきなりVSTが完成するはずです。</strong></p>

<p><img src="/assets/img/faust/juce_xcode.png" alt="" /></p>

<p><img src="/assets/img/faust/juce_build.png" alt="" /></p>

<p><strong>できました。</strong>最高ですね。試しにスタンドアロンのアプリを開きます。</p>

<p><img src="/assets/img/faust/juce_gui.png" alt="" /></p>

<p>行けてますね。これもフィードバックループに気をつけつつマイク入力から試してみて下さい。</p>

<p>プラグインの方もMaxで試してみましょう。ホワイトノイズを突っ込んでスペクトログラムを見てみます。</p>

<p><img src="/assets/img/faust/juce_max.png" alt="" /></p>

<p>いい感じですね。というわけで最も簡単にFaust&amp;JUCEでGUI付プラグインを作る方法でした。</p>

<p>今回はオンラインエディタでやってましたがFaustLiveという環境でも可能ですし、ローカルにFaustコンパイラが入っていればJuceプロジェクトを出力するところも全てローカルで行えます(faust2juceというスクリプトがあります)。</p>

<h1 id="どこまでc-を書かずに行けるのか">どこまでC++を書かずに行けるのか</h1>

<p>エフェクター的な信号処理部分に関してはFaustでは</p>

<ul>
<li><strong>スペクトラルプロセッシング（マキシマイザとか、ピッチシフトとか）を使うもの</strong></li>
<li><strong>特定のオーディオファイルを読み込むもの</strong></li>
</ul>

<p><strong>以外</strong>はだいたい作れると言っていいです。</p>

<p>それからGUIに関しては</p>

<ul>
<li>ノブ、スライダー（縦・横）</li>
<li>数値入力</li>
<li>トグルボタン</li>
<li>普通のボタン</li>
<li>シグナルメーター（縦・横）</li>
<li>ラジオボタン</li>
</ul>

<p>このあたりは<strong>Faustのコード上で定義できます</strong>。そしてレイアウトも同様にFaust上で水平、垂直、タブでのグルーピングを駆使することである程度自由度のあるレイアウトが可能です。一方で</p>

<ul>
<li>上記以外のUI（XYパッドとか、JUCEには標準である2,3本まとまったスライダーとか）</li>
<li>UIの個別の大きさ変更、個別の細かいレイアウトの調整</li>
</ul>

<p>等は出来ませんのでこれ以上をやりたいときには自力でJUCE側をいじらないといけません。</p>

<p>問題はfaust2juceやオンラインコンパイラで自動で出力したコードはコンパイラが自動でJUCE用GUIの定義などを書いた依存ファイルを全部1ファイルの中に展開してしまっているのでこちらをベースに編集していくのは結構面倒くさいということです。</p>

<p>そのため最小限構成でfaust→C++にした後でJUCEプロジェクトに読み込み、JUCEUIなどのJUCE連携時に使う便利なクラスは個別にインクルードすればよいということです。</p>

<p>この場合でも<strong>信号処理とそれ以外の部分の開発をコード的にも、開発ワークフロー的にもかなりきれいに切り分けられる</strong>という大きなメリットがあるのでFaust＆JUCEの価値はかなり大きいです。</p>

<p>・・・ですが今回は力尽きたのでここまでということで。。。また時間が取れれば今そちらの構成を試しているところなので書きたいと思います。ありがとうございました。</p>

            <div class="share">
  <div class="tweet">
<a href="https://twitter.com/share" class="twitter-share-button" data-size="large" data-url="https://matsuuratomoya.com/blog/2017-12-02/faust-juce/" data-related="tomoya_nonymous">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>

<div class="fb-share-button" data-href="https://matsuuratomoya.com/blog/2017-12-02/faust-juce/" data-layout="box_count" data-mobile-iframe="true"></div>

</div>

            <hr>

<div class="fb-comments" data-width="100%" data-href="https://matsuuratomoya.com/blog/2017-12-02/faust-juce/" data-numposts="5"></div>

            <div class="pagination">

<ul>
  <li class="to_next">

    <a href=""  class="none">
        
    &lt;&lt;

    </a>

  </li>
  <li class="to_index">

    <a href="../">^</a>

  </li>
  <li class="to_prev">

    <a href="
     https://matsuuratomoya.com/blog/2017-11-20/gakusei_event_web/
    " >

    >>
    
    美大・音大系学生イベントのWebサイトどうにかなんないのか問題
    
    </a>
  </li>


</ul>
</div>

          </div>
        </div>

      </div>

    </div>
    
  <footer>
<div class="child">

<p class = "copyrights">

<a href="https://matsuuratomoya.com/license">2016-2017 (CC BY-NC-ND 4.0) Matsuura Tomoya</a>
</p>
</div>
</footer>

  </div>
</body>
</html>
